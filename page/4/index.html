<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>进化</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="进化">
<meta property="og:url" content="brczo.github.io/page/4/index.html">
<meta property="og:site_name" content="进化">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="进化">
  
    <link rel="alternate" href="/atom.xml" title="进化" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">进化</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="brczo.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-小狗钱钱" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/26/小狗钱钱/" class="article-date">
  <time datetime="2019-04-26T13:37:31.832Z" itemprop="datePublished">2019-04-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/小狗钱钱/">小狗钱钱</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/26/小狗钱钱/">小狗钱钱</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>钱钱语录：<br><strong>如果你只是带着试试看的心态，那么你最后只会以失败而告终，你会一事无成。尝试纯粹只是一种借口，你还没做，就已经给自己想好退路了。不能试验。你只有两个选择：做，不做。</strong></p>
<p><strong>你是否能挣到钱，最关键的因素并不在于你是不是有一个好点子。你有多聪明也不是主要原因，决定因素是你的自信程度。一个人把精力集中在自己所能做的，知道的和拥有的东西上的那天起，他的成功就已经拉开了序幕。这也使得一个孩子完全有能力比成人挣到更多的钱。</strong></p>
<p><strong>你最好想清楚，你喜欢做什么，然后在考虑你怎么用它来挣钱。</strong>我想要知道更多知识，想要知道世界是怎么运作的，并以此赚钱。</p>
<p><strong>你要每天不间断地去做对你的未来意义重大的事情。你为此花费的时间不会超过10分钟，但是就是这10分钟会让一切变得不同。</strong></p>
<p><strong>欠债的人应当毁掉所有的信用卡。应当尽可能少的偿还贷款。应当将不用于生活的那部分钱中的一般存起来，另一半用于还贷。最好不要申请消费贷款。每次借贷前问自己：“这真的有必要吗？”</strong></p>
<p><strong>你为什么不能因为自己做了自己喜欢的事情而挣钱呢？</strong></p>
<p><strong>当你定下了大目标的时候，就意味着你必须付出比别人多得多的努力。</strong></p>
<p><strong>假如我没有了我的“鹅”，我就总是得为了赚钱而工作，但是一旦我有了属于自己的“鹅”，我的钱就会自动为我工作。</strong></p>
<p><strong>幸运其实只是充分准备加上努力工作的结果。</strong></p>
<p><strong>确定自己希望获得财务上的成功。</strong></p>
<p><strong>自信，有想法，做自己喜欢做的事。</strong></p>
<p><strong>把钱分成日常开销、梦想目标和金鹅账户三部分。</strong></p>
<p><strong>进行明智的投资。</strong></p>
<p><strong>享受生活。</strong></p>
<p><strong>如果你没有做今天这件事情，你就永远不会知道，给自己一些压力之后，你就能够做到些什么。一个人觉得最引以为傲的事情，往往是那些做起来最艰难的事情。</strong></p>
<p><strong>挑选基金时的注意事项：</strong><br><strong>1.基金应该至少有10年历史。加入它在这么长时间内一直有着丰厚的利润，那我们就可以认为，它在未来也会运作良好。</strong><br><strong>2.应该选择大型的跨国股票基金，这种基金在世界各地购买股票，一次分散风险，所以十分安全。</strong><br><strong>3.对基金的走势图进行比较。我们应该观察在过去10年间哪些基金的年终获利最好。</strong><br><strong>用72除以投资的年收益率的百分比，得出的数字就是这笔钱翻一倍所要的年数。</strong></p>
<p><strong>每当冬天过后，春天到来，接着是夏天，每个夏天过后又跟着是秋天，然后是冬天，年年如此。跟大自然的变化一样，交易所也总有四季更替，循环往复。</strong></p>
<p><strong>不要为失去的东西而忧伤，而要对拥有它的时光心存感激。</strong></p>
<p><strong>最重要的是，在人们眼中钱应该是一种再自然、再普通不过的东西了。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/26/小狗钱钱/" data-id="cjv6d1dim003j5cjbi2ff9vbv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js设计模式与开发实践0701" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/25/js设计模式与开发实践0701/" class="article-date">
  <time datetime="2019-04-25T08:45:22.526Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/js设计模式与开发实践0701/">第七章 迭代器模式 01</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。迭代器模式可以把迭代的过程从业务逻辑中分离出来，在使用迭代器模式之后，即使不关心对象的内部构造，也可以按顺序访问其中的每个元素。</p>
<h2 id="实现自己的迭代器"><a href="#实现自己的迭代器" class="headerlink" title="实现自己的迭代器"></a>实现自己的迭代器</h2><p>实现一个each函数，each函数接受2个参数，第一个为被循环的数组，第二个为循环中的每一步后将被触发的回掉函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var each = function(arr, callback) &#123;</span><br><span class="line">    for(var i = 0, l = arr.length; i &lt; l; i++) &#123;</span><br><span class="line">        callback.call(arr[i], i, arr[i]); //把下标和元素当作参数传给callback函数</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">each([1,2,3], function(i, n)&#123;</span><br><span class="line">    console.log([i,n]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="内部迭代器和外部迭代器"><a href="#内部迭代器和外部迭代器" class="headerlink" title="内部迭代器和外部迭代器"></a>内部迭代器和外部迭代器</h2><h3 id="内部迭代器"><a href="#内部迭代器" class="headerlink" title="内部迭代器"></a>内部迭代器</h3><p>上面编写的each函数就是内部迭代器，each函数的内部已经定义好了迭代规则，它完全接受整个迭代过程，外部只需要一次初始调用。由于内部迭代器被提前定义了规则，上面的each函数就无法同时迭代2个数组了。比如现在有个需求，要判断2个数组里元素的值是否完全相等，如果不该写each函数本身的代码，我们能够入手的地方似乎只有each的回掉函数了，代码如下：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var compare = function(arr1, arr2)&#123;</span><br><span class="line">    if(arr1.length !== arr2.length)&#123;</span><br><span class="line">        throw new Error(&apos;arr1和arr2不想等&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    each(arr1, function(i, n)&#123;</span><br><span class="line">        if(n !== arr2[i])&#123;</span><br><span class="line">            throw new Error(&apos;arr1和arr2不想等&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    console.log(&apos;arr1和arr2相等&apos;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p> 说实话，这个compare函数一点都算不上好看，我们目前能够顺利完成需求，还要感谢在js里可以把函数当作参数传递的特性，但在其他语言中未必能够实现。</p>
<h3 id="外部迭代器"><a href="#外部迭代器" class="headerlink" title="外部迭代器"></a>外部迭代器</h3><p> 外部迭代器必须显式地请求迭代下一个元素。外部迭代器增加了迭代器的灵活性，我们可以手工控制迭代的过程或者顺序。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">var Iterator = function(ob) &#123;</span><br><span class="line">    var current = 0;</span><br><span class="line"></span><br><span class="line">    var next = function() &#123;</span><br><span class="line">        current += 1;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var isDone = function()&#123;</span><br><span class="line">        return current &gt;= obj.length;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var getCurrItem = function()&#123;</span><br><span class="line">        return obj[current];</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var getLength = function()&#123;</span><br><span class="line">        return obj.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        next: next,</span><br><span class="line">        isDone: isDone,</span><br><span class="line">        getCurrItem: getCurrItem,</span><br><span class="line">        getLength: getLength</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var compare = function(iterator1, iterator2) &#123;</span><br><span class="line">    if(iterator1.getLength !== iterator2.getLength)</span><br><span class="line">        throw new Error(&apos;iterator1与iterator2不相等&apos;);</span><br><span class="line">    while(!iterator1.isDone() &amp;&amp; !iterator2.isDone()) &#123;</span><br><span class="line">        if(iterator1.getCurrItem() !== iterator2.getCurrItem()) &#123;</span><br><span class="line">            throw new Error(&apos;iterator1与iterator2不相等&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        iterator1.next();</span><br><span class="line">        iterator2.next();</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&apos;iterator1与iterator2相等&apos;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var iterator1 = iterator([1,2,3]);</span><br><span class="line">var iterator2 = iterator([1,2,3]);</span><br><span class="line">compare(iterator1, iterator2);</span><br></pre></td></tr></table></figure></p>
<p> 外部迭代器虽然调用方式相对复杂，但它的适用面更广，也能满足更多变的需求。</p>
<h2 id="迭代类数组对象和字面量对象"><a href="#迭代类数组对象和字面量对象" class="headerlink" title="迭代类数组对象和字面量对象"></a>迭代类数组对象和字面量对象</h2><p> 迭代器模式不仅可以迭代数组，还可以迭代一些类数组的对象。比如arguments、{“0”:’a’,”1”:’b’}等。通过上面的代码观察到，无论是内部迭代器还是外部迭代器，只要迭代的聚合对象拥有length属性，而且可以用下表访问，那它就可以被迭代。<br> 在js中，for in语句可以用来迭代普通字面量对象的属性。jq中提供了$.each来封装各种迭代行为：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$.each = function(obj, callback)&#123;</span><br><span class="line">    var value,</span><br><span class="line">        i = 0,</span><br><span class="line">        length = obj.length,</span><br><span class="line">        isArray = isArraylike(obj); //isArraylist 是jq中的函数</span><br><span class="line">        if(isArray) &#123; //迭代类数组</span><br><span class="line">           for(; i &lt; length; i++)&#123;</span><br><span class="line">               value = callback.call(obj[i], i, obj[i]);</span><br><span class="line">               if(value === false)&#123;</span><br><span class="line">                   break;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            for(i in obj) &#123; //迭代object对象</span><br><span class="line">               value = callback.call(obj[i], i obj[i]);</span><br><span class="line">               if(value === false)&#123;</span><br><span class="line">                   break;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    return obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/25/js设计模式与开发实践0701/" data-id="cjv6d1dh6001n5cjbt6pedfrl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-php设计模式03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/25/php设计模式03/" class="article-date">
  <time datetime="2019-04-25T03:45:36.723Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP设计模式/">PHP设计模式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/php设计模式03/">代理模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>简单代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//想吃面包又懒得去买的我。</span><br><span class="line">class me &#123;</span><br><span class="line">    public function buyBread()&#123;</span><br><span class="line">        //那就让女朋友去买吧</span><br><span class="line">        (new girlFriend())-&gt;buyBread();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 女朋友</span><br><span class="line">class girlFriend &#123;</span><br><span class="line">    public function buyBread()&#123;</span><br><span class="line">       (new shop())-&gt;cuiyiban()；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//商店</span><br><span class="line">class shop &#123;</span><br><span class="line">    public function cuoyiban()&#123;</span><br><span class="line">        echo &apos;买到搓衣板&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//(^○^) 喔， 好爽。</span><br><span class="line">$me = (new me())-&gt;buyBread();</span><br></pre></td></tr></table></figure></p>
<p>虚拟代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 贾跑跑没有钱，但他很会忽悠</span><br><span class="line">class jiapaopao &#123;</span><br><span class="line">    public function investor()&#123;</span><br><span class="line">        (new investors)-&gt;investor)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 投资方有钱，但容易被忽悠</span><br><span class="line">class investors &#123;</span><br><span class="line">    public $money;</span><br><span class="line">    public function investor()&#123;</span><br><span class="line">        (new market())-&gt;eat($this-&gt;money);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 难预测的市场</span><br><span class="line">class market &#123;</span><br><span class="line">    public function eat($money)&#123;</span><br><span class="line">        echo &apos;好吃&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>策略模式 + 缓存代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">class strategies &#123;</span><br><span class="line">    public function mult() &#123;</span><br><span class="line">        echo &apos;计算乘积&apos;;</span><br><span class="line">        echo PHP_EOL;</span><br><span class="line">        $args = explode(&apos;,&apos;, func_get_args()[0]);</span><br><span class="line">        $a = 1;</span><br><span class="line">        foreach($args as $val) &#123;</span><br><span class="line">            $a *= $val;</span><br><span class="line">        &#125;</span><br><span class="line">        return $a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function plus() &#123;</span><br><span class="line">        echo &apos;计算和&apos;;</span><br><span class="line">        echo PHP_EOL;</span><br><span class="line">        $args = explode(&apos;,&apos;, func_get_args()[0]);</span><br><span class="line">        $a = 1;</span><br><span class="line">        foreach($args as $val)&#123;</span><br><span class="line">            $a += $val;</span><br><span class="line">        &#125;</span><br><span class="line">        return $a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class proxyCache &#123;</span><br><span class="line">    private $cache = [];</span><br><span class="line">    private $strategy;</span><br><span class="line">    private $strategies;</span><br><span class="line"></span><br><span class="line">    public function __construct($strategy)&#123;</span><br><span class="line">        $this-&gt;strategies = new strategies();</span><br><span class="line">        $this-&gt;strategy = $strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function count()&#123;</span><br><span class="line">        $args = implode(&apos;,&apos;, func_get_args()[0]);</span><br><span class="line">        if(array_key_exists($args, $this-&gt;cache))&#123;</span><br><span class="line">            return $this-&gt;cache[$args];</span><br><span class="line">        &#125;</span><br><span class="line">        return $this-&gt;cache[$args] = $this-&gt;strategies-&gt;&#123;$this-&gt;strategy&#125;($args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __call($name, $args)&#123;</span><br><span class="line">        return $this-&gt;count($args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$multProxy = new proxyCache(&apos;mult&apos;);</span><br><span class="line">var_dump($multProxy-&gt;mult(1,2,3,4));</span><br><span class="line">var_dump($multProxy-&gt;mult(1,2,3,4));</span><br><span class="line"></span><br><span class="line">$plusProxy = new proxyCache(&apos;plus&apos;);</span><br><span class="line">var_dump($plusProxy-&gt;plus(1,2,3,4));</span><br><span class="line">var_dump($plusProxy-&gt;plus(1,2,3,4));</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/25/php设计模式03/" data-id="cjv6d1dhu002p5cjb0bpt58mq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js设计模式与开发实践0604" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/25/js设计模式与开发实践0604/" class="article-date">
  <time datetime="2019-04-25T02:17:48.079Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/js设计模式与开发实践0604/">第六章 代理模式 缓存代理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>缓存代理可以为一些开销大的运算结果提供暂时的存储，在下次运算时，如果传递进来的参数跟之前的一致，则可以直接返回千面存储的运算结果</p>
<h2 id="计算乘积"><a href="#计算乘积" class="headerlink" title="计算乘积"></a>计算乘积</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var mult = function()&#123;</span><br><span class="line">    console.log(&apos;开始计算乘积&apos;);</span><br><span class="line">    var a = 1;</span><br><span class="line">    for(var i = 0, l = arguments.length; i &lt; l; i++) &#123;</span><br><span class="line">        a = a * arguments[i];</span><br><span class="line">    &#125;</span><br><span class="line">    return a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">mult(2,3); </span><br><span class="line">mult(2,3,4);</span><br></pre></td></tr></table></figure>
<p>加入缓存代理函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var proxyMult = (function()&#123;</span><br><span class="line">    var cache = &#123;&#125;;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        var args = Array.prototype.join.call(arguments, &apos;,&apos;);</span><br><span class="line">        if(args in cache) &#123;</span><br><span class="line">            return cache[args];</span><br><span class="line">        &#125;</span><br><span class="line">        return cache[args] = mult.apply(this, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">proxyMult(2,3);</span><br><span class="line">proxyMult(2,3); //这里会使用缓存</span><br></pre></td></tr></table></figure></p>
<h2 id="缓存代理用于ajax异步请求数据"><a href="#缓存代理用于ajax异步请求数据" class="headerlink" title="缓存代理用于ajax异步请求数据"></a>缓存代理用于ajax异步请求数据</h2><p>我们常常在项目中遇到分页的需求，同一页的数据理论上只需要去后台拉去一次，这些已经拉取的数据在某个地方缓存之后，下次再请求同一页的时候，便可以直接食用之前的数据。</p>
<h2 id="用高阶函数动态创建代理"><a href="#用高阶函数动态创建代理" class="headerlink" title="用高阶函数动态创建代理"></a>用高阶函数动态创建代理</h2><p>通过传入高阶函数这种更加灵活的方式，可以为各种计算方法创建缓存代理。现在这些计算方法被当作参数传入一个专门用于创建缓存代理的工厂中，这样以来我们就可以为乘法、加法、减法等创建缓存代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/************** 计算乘积 *****************/</span><br><span class="line">var mult = function()&#123;</span><br><span class="line">    var a = 1;</span><br><span class="line">    for(var i = 0, l = arguments.length; i &lt; l; i++)&#123;</span><br><span class="line">        a *= argumens[i];</span><br><span class="line">    &#125;</span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/************ 计算和 *****************/</span><br><span class="line">var plus = function()&#123;</span><br><span class="line">    var a = 0;</span><br><span class="line">    for(var i = 0, l = arguments.length; i &lt; l; i++) &#123;</span><br><span class="line">        a += arguments[i];</span><br><span class="line">    &#125;</span><br><span class="line">    return a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/************ 创建缓存代理工厂 *********/</span><br><span class="line">var createProxyFactory = function(fn) &#123;</span><br><span class="line">    var cache = &#123;&#125;;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        var args = Array.prototype.join.call(arguments, &apos;,&apos;);</span><br><span class="line">        if(args in cache)&#123;</span><br><span class="line">            return cache[args];</span><br><span class="line">        &#125;</span><br><span class="line">        return cache[args] = fn.apply(this, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var proxyMult = createProxyFactory(mult);</span><br><span class="line">var proxyPlus = createProxyFactory(plus);</span><br><span class="line"></span><br><span class="line">console.log(proxyMult(1,2,3,4));</span><br><span class="line">console.log(proxyMult(1,2,3,4));</span><br><span class="line">console.log(proxyPlus(1,2,3,4));</span><br><span class="line">console.log(proxyPlus(1,2,3,4));</span><br></pre></td></tr></table></figure></p>
<p>策略模式 + 缓存代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">var strategies = &#123;</span><br><span class="line">    mult: function()&#123;</span><br><span class="line">        var a = 1;</span><br><span class="line">        for(var i = 0, l = arguments.length; i &lt; l; i++)&#123;</span><br><span class="line">            a *= arguments[i];</span><br><span class="line">        &#125;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;,</span><br><span class="line">    plus: function()&#123;</span><br><span class="line">        var a = 1;</span><br><span class="line">        for(var i = 0, l = arguments.length; i &lt; l; i++)&#123;</span><br><span class="line">            a += arguments[i];</span><br><span class="line">        &#125;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var createProxyFactory = function(fn)&#123;</span><br><span class="line">    var cache = &#123;&#125;;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        var args = Array.prototype.join.call(arguments. &apos;,&apos;);</span><br><span class="line">        if(args in cache)&#123;</span><br><span class="line">            return cache[args];</span><br><span class="line">        &#125;</span><br><span class="line">        return cache[args] = fn.apply(this, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var proxyMult = createProxyFactory(strategies.mult);</span><br><span class="line">var proxyMult = createProxyFactory(strategies.plus);</span><br></pre></td></tr></table></figure></p>
<h2 id="其他代理模式"><a href="#其他代理模式" class="headerlink" title="其他代理模式"></a>其他代理模式</h2><ul>
<li>防火墙代理： 控制网络资源的访问，保护主题不让“坏人接近“。</li>
<li>远程代理：为一个对象在不同的地址空间提供局部代表。</li>
<li>保护代理： 用于对象应该有不同访问权限的情况</li>
<li>智能引用代理： 取代了简单的指针，它在访问对象时执行一些附加操作，比如计算一个对象被引用的次数。</li>
<li>写时复制代理：通常用于复制一个庞大对象的情况。写时复制代理延迟了复制的过程，当对象被真正修改时，才对它进行复制操作。写时复制代理是虚拟代理的一种变体。DLL（操作系统中的动态链接库）是其典型运用场景。</li>
</ul>
<p>尽管代理模式有用，但我们在编写业务代码时，往往不需要去预先猜测是否需要使用代理模式。当真正发现不方便直接访问某个对象的时候，再编写代理也不迟。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/25/js设计模式与开发实践0604/" data-id="cjv6d1dh4001j5cjbgxcd452p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js设计模式与开发实践0603" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/25/js设计模式与开发实践0603/" class="article-date">
  <time datetime="2019-04-25T01:27:41.856Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/js设计模式与开发实践0603/">第六章 代理模式 虚拟代理合并HTTP请求</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>点一下checkbox发送一次请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; id=&quot;1&quot;/&gt;1</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; id=&quot;2&quot;/&gt;2</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; id=&quot;3&quot;/&gt;3</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; id=&quot;4&quot;/&gt;4</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; id=&quot;5&quot;/&gt;5</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; id=&quot;6&quot;/&gt;6</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; id=&quot;7&quot;/&gt;7</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var synchronousFile = function(id)&#123;</span><br><span class="line">        console.log(&apos;开始同步文件，id为：&apos; + id);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var checkbox = document.getElementByTagName(&apos;input&apos;);</span><br><span class="line">    for(var i = 0, c; c = checkbox(i++);)&#123;</span><br><span class="line">        c.onclick = function()&#123;</span><br><span class="line">            if(this.checked === true)&#123;</span><br><span class="line">                synchronousFile(this.id);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>为了减轻服务器压力，我们可以将2秒内的请求一次性发送<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">var synchronousFile = function(id) &#123;</span><br><span class="line">    console.log(&apos;开始同步文件&apos; + id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var proxySynchronousFile = (function()&#123;</span><br><span class="line">    var cache = [], //保存一段时间内需要同步的ID</span><br><span class="line">        timer;  //定时器</span><br><span class="line">    return function(id) &#123;</span><br><span class="line">        cache.push(id);</span><br><span class="line">        if(timer) &#123; //保证不会覆盖已经启动的定时器</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(function()&#123;</span><br><span class="line">            synchronousFile(cache.join(&apos;,&apos;)); //2秒后向本体发送需要同步的ID集合</span><br><span class="line">            clearTimeOut(timer); //清空定时器</span><br><span class="line">            timer = null;</span><br><span class="line">            cache.length = 0; //晴空ID集合</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var checkbox = document.getElementsByTagName(&apos;input&apos;);</span><br><span class="line"></span><br><span class="line">for(var i = 0, c; c = checkbox[i++]) &#123;</span><br><span class="line">    c.onclick = function()&#123;</span><br><span class="line">        if(this.checked === true) &#123;</span><br><span class="line">            proxySynchronousFile(this.id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/25/js设计模式与开发实践0603/" data-id="cjv6d1dgx001d5cjbpquhyh9i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js设计模式与开发实践0602" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/24/js设计模式与开发实践0602/" class="article-date">
  <time datetime="2019-04-24T12:24:08.448Z" itemprop="datePublished">2019-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/24/js设计模式与开发实践0602/">第六章 代理模式 虚拟代理实现图片预加载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在web开发中，图片预加载是一种常用的技术，如果直接给某个img标签节点设置src属性，由于图片过大或者网络不佳，图片的位置往往有段时间会是一片空白。常见的做法是先用一张loading图片占位，然后用异步的方式加载图片，等图片加载好了再把它填充到img节点里，这种场景就很是时候使用虚拟代理。</p>
<p>创建一个普通的本体对象，这个对象负责往页面创建一个img标签，并且提供一个对外的serSrc接口，便可以给该image标签设置src属性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var MyImage = (function()&#123;</span><br><span class="line">    var imgNode = document.createElement(&apos;img&apos;);</span><br><span class="line">    document.body.apppendChild(imgNode);</span><br><span class="line">    return &#123;</span><br><span class="line">        setSrc: function(src)&#123;</span><br><span class="line">            imgNode.src = src;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">myImage.serSrc(&apos;http://picture.jpg&apos;);</span><br></pre></td></tr></table></figure></p>
<p>引入代理对象proxyImage，通过这个代理对象，在图片被真正加载好之前，页面中将出现一张占位的菊花图loading.gif，来提示用户图片正在加载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var myImage = (function()&#123;</span><br><span class="line">    var imgNode = document.createElement(&apos;img&apos;);</span><br><span class="line">    document.body.appendChild(imgNode);</span><br><span class="line">    return &#123;</span><br><span class="line">        setSrc: function(src) &#123;</span><br><span class="line">            imgNode.src = src;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">var proxyImage = (function()&#123;</span><br><span class="line">    var img = new Image;</span><br><span class="line">    img.onload = function()&#123;</span><br><span class="line">        myImage.serSrc(this.src);</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">        setSrc: function(src) &#123;</span><br><span class="line">            imImage.setSrc(&apos;loading.gif&apos;);</span><br><span class="line">            img.src = src;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">proxyImage.setSrc(&apos;http://someone.jpg&apos;);</span><br></pre></td></tr></table></figure></p>
<h2 id="代理的意义"><a href="#代理的意义" class="headerlink" title="代理的意义"></a>代理的意义</h2><p>不用代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var myImage = (function()&#123;</span><br><span class="line">    var imgNode = document.createElement(&apos;img&apos;);</span><br><span class="line">    document.body.appendChild(&apos;imgNode&apos;);</span><br><span class="line">    var img = new Image;</span><br><span class="line"></span><br><span class="line">    img.onload = function()&#123;</span><br><span class="line">        imgNode.src = img.src;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        setSrc: function()&#123;</span><br><span class="line">            imgNode.src = &apos;loading.gif&apos;;</span><br><span class="line">            img.src = src;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">myImage.setSrc(&apos;picture.jpg&apos;);</span><br></pre></td></tr></table></figure></p>
<p>为了说明代理的意义，我们引入面向对象设计的原则—单一职责原则。<br>单一指责原则指的是，就一个类（通常也包括对象和函数等）而言，应该仅有一个引起它变化的原因。如果一个对象承担了多想职责，就意味着这个对象将变得巨大，引起它变化的原因可能会有多个。面向对象设计鼓励将行为分布到细粒度的对象之中，如果一个对象承当的责任过多，等于把这些职责耦合到了一起，这种耦合会导致脆弱和低内聚的设计。当变化发生时，设计可能会遭到意外的破坏。</p>
<h2 id="代理和本体接口的一致性"><a href="#代理和本体接口的一致性" class="headerlink" title="代理和本体接口的一致性"></a>代理和本体接口的一致性</h2><p>如果我们有一天不需要预加载，那么就不再需要代理对象，可以选择直接请求本体。其中关键是代理对象和本体都对外提供了setSrc方法，在客户看来，代理对象和本体是一致的，代理接手请求的过程对于用户来说是透明的，用户并不清楚代理和本体的区别，这样做的好处。</p>
<blockquote>
<p>用户可以放心的请求代理，他只关心是否能得到想要的结果。<br>在任何使用本体的地方都可以替换成使用代理</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var myImage = (function()&#123;</span><br><span class="line">    var imgNode = document.createElement(&apos;img&apos;);</span><br><span class="line">    document.body.appendChild(imgNode);</span><br><span class="line"></span><br><span class="line">    return function(src)&#123;</span><br><span class="line">        imgNode.src = src;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">var proxyImage = (function()&#123;</span><br><span class="line">    var img = new Image;</span><br><span class="line">    img.onload = function()&#123;</span><br><span class="line">        myImage(this.src);</span><br><span class="line">    &#125;</span><br><span class="line">    return function(src) &#123;</span><br><span class="line">        myImage(&apos;loading.src&apos;);</span><br><span class="line">        img.src = src;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/24/js设计模式与开发实践0602/" data-id="cjv6d1dh2001h5cjb7ms4pmm5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js设计模式与开发实践0601" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/24/js设计模式与开发实践0601/" class="article-date">
  <time datetime="2019-04-24T11:40:25.104Z" itemprop="datePublished">2019-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/24/js设计模式与开发实践0601/">第六章 代理模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>代理模式是为一个对象提供一个代用品或占位符，以便控制对它的访问。代理模式的关键是，当客户不方便直接访问一个对象或不满足需要的时候，提供一个替身来控制对这个对象的访问，客户实际上访问的是替身对象。替身对象对请求做出一些处理之后，再把请求转给本体对象。</p>
<p>在四月一个晴朗的早晨，小明遇见了他的百分百女孩，我们暂且叫小明的女神为A。两天后，小明决定给A送一束花来表白。刚好小明打听到A和他有一个共同好友B，于是内向的小明决定让B来代替自己完成送花这件事。虽然小明的故事必将以悲剧收场，因为追MM更好的方式是送她一辆宝马。</p>
<p>不用代理的情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var flower = function()&#123;&#125;;</span><br><span class="line">var xiaoming = &#123;</span><br><span class="line">    sendFlower: function(target) &#123;</span><br><span class="line">        var flower = new Flower();</span><br><span class="line">        target.receiveFlower(flower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var A = &#123;</span><br><span class="line">    receiveFlower: function(flower) &#123;</span><br><span class="line">        console.log(&apos;收到花&apos; + flower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.sendFlower(A);</span><br></pre></td></tr></table></figure></p>
<p>使用代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var Flower = function()&#123;&#125;;</span><br><span class="line">var xiaoming = &#123;</span><br><span class="line">    sendFlower: function(target)&#123;</span><br><span class="line">        var flower = new Flower();</span><br><span class="line">        target.receiveFlower(flower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var B = &#123;</span><br><span class="line">    receiveFlower: function(flower) &#123;</span><br><span class="line">        A.receiveFlower(flower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var A = &#123;</span><br><span class="line">    receiveFlower: function(flower) &#123;</span><br><span class="line">        console.log(&apos;收到花&apos; + flower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xiaoming.sendFlower(B);</span><br></pre></td></tr></table></figure></p>
<p>B会监听A的心情，在A心情好的时候将花交给A<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">var Flower = function()&#123;&#125;</span><br><span class="line"></span><br><span class="line">var xiaoming = &#123;</span><br><span class="line">    sendFlower: function(target)&#123;</span><br><span class="line">        var flower = new Flower();</span><br><span class="line">        target.recerveFlower(flower);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var B = &#123;</span><br><span class="line">    recerveFlower: function(flower) &#123;</span><br><span class="line">        A.listenGoodMood(function()&#123; //监听A的好心情</span><br><span class="line">            A.receiveFlower(flower); </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var A = &#123;</span><br><span class="line">    receiveFlower: function(flower) &#123;</span><br><span class="line">        console.log(&apos;收到花&apos; + flower);</span><br><span class="line">    &#125;,</span><br><span class="line">    listenGoodMood: function(fn) &#123;</span><br><span class="line">        setTimeout(function()&#123;  //假设10秒后A的心情变好</span><br><span class="line">            fn();</span><br><span class="line">        &#125;, 10000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.sendFlower(B);</span><br></pre></td></tr></table></figure></p>
<h2 id="保护代理和虚拟代理"><a href="#保护代理和虚拟代理" class="headerlink" title="保护代理和虚拟代理"></a>保护代理和虚拟代理</h2><p>代理B可以帮助A过滤掉一些请求，比如送花的人中年龄太大的或者没有宝马的，这种请求就可以直接在代理B处被处理掉。这种代理叫做保护代理。A和B一个充当白脸，一个充当黑脸。白脸A继续保持良好的女神形象，不希望拒绝任何人，于是找到了黑脸B来控制对A的访问。<br>另外，假设现实中的花价格不菲，导致在程序世界里，new Flower也是一个代价昂贵的操作，那么我们可以把new Flower的操作交给代理B去执行，代理B会在A心情好的时候再执行new Flower，这是代理模式的另一种形式，叫做虚拟代理。虚拟代理把一些开销很大的对象，延迟到真正需要它的时候才去创建。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var B = &#123;</span><br><span class="line">    receiveFlower: function()&#123;</span><br><span class="line">        A.listenGoodMood(function()&#123; //监听A的好心情</span><br><span class="line">            var flower = new Flower(); //延迟创建flower对象</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/24/js设计模式与开发实践0601/" data-id="cjv6d1dgz001f5cjbf1hjzu33" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-php设计模式02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/24/php设计模式02/" class="article-date">
  <time datetime="2019-04-24T11:28:04.144Z" itemprop="datePublished">2019-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP设计模式/">PHP设计模式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/24/php设计模式02/">策略模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>策略类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Strategies &#123;</span><br><span class="line">    public funciton php()&#123;</span><br><span class="line">        echo &apos;用php解决&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function go()&#123;</span><br><span class="line">        echo &apos;用go解决&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function python()&#123;</span><br><span class="line">        echo &apos;用python解决&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>context类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Context &#123;</span><br><span class="line">    public $strategy;</span><br><span class="line">    public function setStrategy($strategy)&#123;</span><br><span class="line">        $this-&gt;strategy = $strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    public function web() &#123;</span><br><span class="line">        (new Strategy)-&gt;&#123;$this-&gt;strategy&#125;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/24/php设计模式02/" data-id="cjv6d1dhl002c5cjbix7bhe0x" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js设计模式与开发实践0503" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/24/js设计模式与开发实践0503/" class="article-date">
  <time datetime="2019-04-24T01:19:08.639Z" itemprop="datePublished">2019-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/24/js设计模式与开发实践0503/">第五章 策略模式03 表单校验</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="版本一"><a href="#版本一" class="headerlink" title="版本一"></a>版本一</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action=&quot;#&quot; id=&quot;registerForm&quot; method=&quot;post&quot;&gt;</span><br><span class="line">            请输入用户名：&lt;input type=&quot;text&quot; name=&quot;userName&quot;/&gt;</span><br><span class="line">            请输入密码：&lt;input type=&quot;text&quot; name=&quot;password&quot;/&gt;</span><br><span class="line">            请输入手机号码：&lt;input type=&quot;text&quot; name=&quot;phoneNumber&quot; /&gt;</span><br><span class="line">            &lt;button&gt;提交&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var registerForm = document.getElementById(&apos;registerForm&apos;);</span><br><span class="line">        registerForm.onsubmit = function()&#123;</span><br><span class="line">            if(registerForm.userName.value === &apos;&apos;)&#123;</span><br><span class="line">                console.log(&apos;用户名不能为空&apos;);</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">            if(registerForm.password.value.length &lt; 6)&#123;</span><br><span class="line">                console.log(&apos;密码长度不能少于6位&apos;);</span><br><span class="line">                return fasle;</span><br><span class="line">            &#125;</span><br><span class="line">            if(!/(1[358])[0-9]&#123;9&#125;$)/.test(registerForm.phoneNumber.value)&#123;</span><br><span class="line">                console.log(&apos;手机号码格式不正确&apos;);</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>代码编写方式的缺点：</p>
<blockquote>
<p>函数庞大<br>缺乏弹性<br>算法复用性差</p>
</blockquote>
<h2 id="用策略模式重构表单"><a href="#用策略模式重构表单" class="headerlink" title="用策略模式重构表单"></a>用策略模式重构表单</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">var strategies = &#123;</span><br><span class="line">    isNonEmpty: function(value, errorMsg)&#123; //不为空</span><br><span class="line">        if(value === &apos;&apos;)&#123;</span><br><span class="line">            return errorMsg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    minLength: function(value, errorMsg)&#123; //限制最小长度</span><br><span class="line">        if(value.length &lt; 6)&#123;</span><br><span class="line">            return errorMsg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    isPhoneNumber: function(value, errorMsg)&#123; //判断是否为正确的手机号</span><br><span class="line">        if(!/(^1[358][0-9]&#123;9&#125;$)/.test(value)) &#123;</span><br><span class="line">            return errorMsg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var validateFunc = function()&#123;</span><br><span class="line">    var validator = new Validator();  //创建一个validator对象</span><br><span class="line">    /************* 添加一些校验规则 ***************/</span><br><span class="line">    validator.add(registerForm.userName,&apos;isNonEmpty&apos;, &apos;用户名不能为空&apos;);</span><br><span class="line">    validator.add(registerForm.password,&apos;minLength:6&apos;, &apos;密码长度不能少于6位&apos;);</span><br><span class="line">    validator.add(registerForm.phoneNumber,&apos;isPhoneNumber&apos;, &apos;手机号码格式不正确&apos;);</span><br><span class="line">    </span><br><span class="line">    var errorMsg = validator.start(); //获得校验结果</span><br><span class="line">    return errorMsg; //返回校验结果</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var registerForm = document.getELementById(&apos;registerFrom&apos;);</span><br><span class="line">registerForm.onsubmit = function()&#123;</span><br><span class="line">    var errorMsg = validatorFunc(); //如果errorMsg有确切的返回值，说明未通过校验</span><br><span class="line">    if(errorMsg) &#123;</span><br><span class="line">        console.log(errorMsg);</span><br><span class="line">        return false; //组织表单提交</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var Validator = function()&#123;</span><br><span class="line">    this.cache = []; //保存校验规则</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.add = function(dom, rule, errorMsg) &#123;</span><br><span class="line">    var arr = rule.split(&apos;:&apos;); //把strategy和参数分开</span><br><span class="line">    this.cache.push(function()&#123; //把校验的步骤用空函数包装起来，并且放入cache</span><br><span class="line">        var strategy = arr.shift(); //用户挑选的strategy</span><br><span class="line">        arr.unshift(dom.value); //把input的value添加进参数列表</span><br><span class="line">        arr.push(errorMsg); // 把errorMsg添加进参数列表</span><br><span class="line">        return strategies[strategy].apply(dom, arr);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.start = function()&#123;</span><br><span class="line">    for(var i = 0, validatorFunc; validatorFunc = this.cache[i++];) &#123;</span><br><span class="line">        var msg = validatorFunc(); //开始校验，并取得校验后的返回信息</span><br><span class="line">        if(msg)&#123; //如果有确切的返回值，说明校验没有通过</span><br><span class="line">            return msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/24/js设计模式与开发实践0503/" data-id="cjv6d1dgs00175cjb8d904gbf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js设计模式与开发实践0502" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/23/js设计模式与开发实践0502/" class="article-date">
  <time datetime="2019-04-23T07:28:57.412Z" itemprop="datePublished">2019-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/23/js设计模式与开发实践0502/">第五章 策略模式02 多态在策略模式中的体现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="使用策略模式实现缓动动画"><a href="#使用策略模式实现缓动动画" class="headerlink" title="使用策略模式实现缓动动画"></a>使用策略模式实现缓动动画</h2><p>先记录一些有用的信息</p>
<ul>
<li>动画开始时，小球所在的原始位置</li>
<li>小球移动的目标位置</li>
<li>动画开始时的准确时间点</li>
<li>小球运动持续的时间</li>
</ul>
<p>用setInterval创建一个定时器，定时器每隔19ms循环一次。在定时器的每一帧里，我们会把动画已消失的时间、小球的原始位置、小球目标位置和动画持续的总时间等传入缓动算法。该算法通过这几个参数，计算出小球当前应该所在的位置。最后再更新该div对应的css属性，小球就能顺利地运动起来了。</p>
<h3 id="让小球运动起来"><a href="#让小球运动起来" class="headerlink" title="让小球运动起来"></a>让小球运动起来</h3><p><strong>常见缓动算法</strong>。4个参数分别为动画已消耗的时间、小球原始位置、小球目标位置、动画持续的总时间；返回的值则是动画元素应该处在的当前位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var tween = &#123;</span><br><span class="line">    linear: function(t, b, c, d)&#123;</span><br><span class="line">        return c*t/d + b;</span><br><span class="line">    &#125;,</span><br><span class="line">    easeIn: function(t, b, c, d)&#123;</span><br><span class="line">        return c*(t/=d)*t + b;</span><br><span class="line">    &#125;,</span><br><span class="line">    strongEaseIn: function(t, b, c, d)&#123;</span><br><span class="line">        return c*(t/=d)*t*t*t*t + b;</span><br><span class="line">    &#125;,</span><br><span class="line">    strongEaseOut: function(t, b, c, d)&#123;</span><br><span class="line">        return c * ((t = t/ d - 1)*t*t*t*t + 1) + b;</span><br><span class="line">    &#125;,</span><br><span class="line">    sineaseIn: function(t,b,c,d)&#123;</span><br><span class="line">        return c * (t/=d) * t*t + b;</span><br><span class="line">    &#125;,</span><br><span class="line">    sineaseOut: function(t,b,c,d)&#123;</span><br><span class="line">        return c*((t = t/d - 1)*t*t + 1) + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div style=&quot;position:absolute;background:blue;&quot; id=&apos;div&apos;&gt;div&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure></p>
<p>Animate类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">var Animal = function(dom)&#123;</span><br><span class="line">    this.dom = dom;  //进行运动的dom节点</span><br><span class="line">    this.startTime = 0; //动画开始时间</span><br><span class="line">    this.startPos = 0; //动画开始是，dom节点的位置，即dom的初始位置</span><br><span class="line">    this.endPos = 0; //动画结束时，dom节点的位置，即dom的目标位置</span><br><span class="line">    this.propertyName = null; // dom节点需要被改变的css属性名</span><br><span class="line">    this.easing = null; //缓动算法</span><br><span class="line">    this.duration = null; //动画持续时间</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @param propertyName: 要改变的CSS属性名，比如left，top，分别表示左右移动和上下移动。</span><br><span class="line"> * @param endPos: 小球运动的目标位置</span><br><span class="line"> * @param duration: 动画持续时间</span><br><span class="line"> * @param easing：缓动算法</span><br><span class="line"> **/</span><br><span class="line">Animal.prototype.start = function(propertyName, endPos, duration, easing) &#123;</span><br><span class="line">    this.startTime = new Date; //动画启动时间</span><br><span class="line">    this.startPos = this.dom.getBoundingClientRect()[propertyName]; //dom节点初始位置</span><br><span class="line">    this.propertyName = propertyName; //dom节点需要被改变的css属性名</span><br><span class="line">    this.endPos = endPos; //dom节点目标位置</span><br><span class="line">    this.duration = duration; //动画持续事件</span><br><span class="line">    this.easing = tween[easing]; //缓动算法</span><br><span class="line">    var self = this;</span><br><span class="line">    var timeId = setInterval(function()&#123; //启动定时器，开始执行动画</span><br><span class="line">        if(self.step() === false)&#123; //如果动画已结束，则清楚定时器</span><br><span class="line">            clearInterval(timeId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, 19);</span><br><span class="line">&#125;;</span><br><span class="line">//定义小球的每一帧都要做的事情</span><br><span class="line">Animal.prototype.step = function()&#123;</span><br><span class="line">    var t = new Date; //取得当前时间</span><br><span class="line">    if(t &gt;= this.startTime + this.duration) &#123; //(1)</span><br><span class="line">        this.update(this.endPos); //更新小球的CSS属性值</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    var pos = this.easing(t - this.startTime, this.startPos,</span><br><span class="line">        this.endPos - this.startPos, this.duration);</span><br><span class="line">    //pos为小球当前位置</span><br><span class="line">    this.update(pos); //更新小球的CSS属性值</span><br><span class="line">&#125;;</span><br><span class="line">Animal.prototype.update = function(pos)&#123;</span><br><span class="line">    this.dom.style[this.propertyName] = pos + &apos;px&apos;;</span><br><span class="line">&#125;;</span><br><span class="line">var div = document.getElementById(&apos;div&apos;);</span><br><span class="line">var animate = new Animate(div);</span><br><span class="line">animate.start(&apos;left&apos;, 500, 1000, &apos;strongEaseOut&apos;);</span><br></pre></td></tr></table></figure></p>
<p>(1)处的意思是，如果当前时间大于动画开始时间加上动画持续时间只和，说明动画已经结束，此时要修正小球的位置。因为在这一帧开始之后，小球的位置已经接近了目标位置，但很可能不完全等于目标位置。此时我们要主动修正小球的当前位置为最终的目标位置。此外让Animal.prototype.step方法返回false，可以同志animate.prorotype.start方法清楚定时器。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="brczo.github.io/2019/04/23/js设计模式与开发实践0502/" data-id="cjv6d1dgv001b5cjbnz8np9h7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CMake/">CMake</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP设计模式/">PHP设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js设计模式与开发实践/">js设计模式与开发实践</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux高性能服务器/">linux高性能服务器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tinyhttpd源码分析/">tinyhttpd源码分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/优势谈判/">优势谈判</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/原则-Ray-Dalio/">原则 Ray Dalio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/富爸爸穷爸爸/">富爸爸穷爸爸</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/小狗钱钱/">小狗钱钱</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/心流/">心流</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高效能人士的七个习惯/">高效能人士的七个习惯</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/05/09/php设计模式10/">享元模式</a>
          </li>
        
          <li>
            <a href="/2019/05/08/php中的坑/">PHP中的坑</a>
          </li>
        
          <li>
            <a href="/2019/05/08/js设计模式与开发实践1203/">第十一章 职责链模式</a>
          </li>
        
          <li>
            <a href="/2019/05/08/js设计模式与开发实践1202/">第十一章 享元模式 文件上传</a>
          </li>
        
          <li>
            <a href="/2019/05/07/js设计模式与开发实践1201/">第十一章 享元模式 基本概念</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 brczo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/scripts/love.js"></script>



  </div>
</body>
</html>